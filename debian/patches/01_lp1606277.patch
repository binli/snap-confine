Description: cherry pick snap-confine patch
Author: Zygmunt Krynicki
Bug-Ubuntu: https://bugs.launchpad.net/bugs/1606277

---
Origin: upstream
Bug-Ubuntu: https://bugs.launchpad.net/bugs/1606277

--- /dev/null
+++ snap-confine-1.0.38/spread-tests/regression/lp-1606277/task.yaml
@@ -0,0 +1,17 @@
+summary: Regression check for https://bugs.launchpad.net/snap-confine/+bug/1606277 
+# This is blacklisted on debian because debian doesn't use apparmor yet
+systems: [-debian-8]
+details: |
+    A missing bind mount for /var/log prevents access to system log files
+    even if the log-observe interface is being used.
+prepare: |
+    echo "Having installed the snapd-hacker-toolbelt snap"
+    snap install snapd-hacker-toolbelt
+    echo "And having connected the log-observe interface"
+    snap connect snapd-hacker-toolbelt:log-observe ubuntu-core:log-observe
+execute: |
+    echo "We can now see a non-empty /var/log directory"
+    cd /
+    [ "$(/snap/bin/snapd-hacker-toolbelt.busybox ls /var/log | wc -l)" != 0 ]
+restore: |
+    snap remove snapd-hacker-toolbelt
--- snap-confine-1.0.38.orig/src/mount-support.c
+++ snap-confine-1.0.38/src/mount-support.c
@@ -204,6 +204,7 @@ void setup_snappy_os_mounts()
 		"/var/snap",	// to get access to global snap data
 		"/var/lib/snapd",	// to get access to snapd state and seccomp profiles
 		"/var/tmp",	// to get access to the other temporary directory
+		"/var/log",	// to get access to log files via log-observe interface
 		"/run",		// to get /run with sockets and what not
 		"/media",	// access to the users removable devices
 		"/lib/modules",	// access to the modules of the running kernel
